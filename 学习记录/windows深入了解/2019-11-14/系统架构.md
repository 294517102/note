# 系统架构
1989年，windows NT的规范要求:
* 提供一个真正32位的、抢占式、可重入的虚拟机内存操作系统
* 在多种硬件体系架构和平台上运行
* 成为一个极好的分布式计算机平台，无论是作为网络客户机还是服务器。
* 能够运行大多数已有的16位MS-DOS和windows3.1的应用程序。
* 符合政府对于POSIX 1003.1兼容性的要求。
* 符合政府和工业界对于操作系统安全性方面的要求。
* 支持Unicode,从而容易适应全球市场。

widnows NT涉及小组在项目开始之初选择了下面的涉及目标
* 扩展性：编写的系统代码必须能够随市场需求的变化而如增长和改变。
* 可移植性：系统必须能运行在多种硬件体系架构上，必须能根据市场的需求相对容易的迁到新的体系架构上。
* 可靠性和健壮性：系统应该能够保护自己，不会因内部的故障和外部的幕改而不能工作，应用程序应该无法伤害操作系统或其他应用程序。
* 兼容性：然windows nt应该扩展已有的技术，但是它的用户界面和API应该与老版本的windows和Ms DOS兼容。而且它也应该能够与其他的系统，比如Unix、os/2很好的互相操作。
* 性能：在其他设计目标的约束下，系统在每一种硬件平台上应尽可能地运行的更快，对外部的响应尽可能的及时

# 操作系统模型
在大多数多用户操作系统中，应用程序与操作系统本身是隔离的。操作系统内核代码运行在处理器的特权模式下，称为内核模式，可以访问系统数据和硬件应用程序代码运行在处理器的非特权模式下称为用户模式。只有很有限的一组接口可以使用，对系统数据的访问受到限制，并且无法直接访问硬件。当用户模式程序调用系统服务时，处理器执行一条特殊的指令，将调用线程切换到内核模式，当该系统服务完成时操作系统将线程切换回用户模式允许调用者继续执行。

Windows是一个庞大而稳定的操作系统，操作系统的大部分代码与设备驱动程序共享，同样的受到内核模式的内存空间。这意味着操作系统的任何一主见。或者设备驱动程序都有可能破坏其他系统组件和使用的数据。

![MtJWwD.png](https://s2.ax1x.com/2019/11/14/MtJWwD.png)


虽然Windows内部普遍使用了对象来表达共享的系统资源。但是从严格的意义上来说，windows并不是一个面向对象的系统。出于移植性的考虑，widnows操作系统的大多数代码是C语言编写的。C语言并不直接支持面向对象的语法元素，比如数据类型的动态绑定、多态或者类继承等。因此，Windows中基于C语言的对象实现只是借用了（但并不依赖于）特定的面向对象语言的特性。

内核模式和用户模式：
![MtYMX6.png](https://s2.ax1x.com/2019/11/14/MtYMX6.png)

用户模式进程有如下四种基本的类型：
* 固定的系统支持进程，比如登录进程和会话管理器，它们并不是windows服务。（也就是说，它们不是由服务控制管理器来启动的）

* 服务进程宿纳的是windows服务，比如Task Scheduler和Print Spooler服务。windows服务往往要求独立于用户登录而运行。许多widnows服务应用，比如sql server，也包含了一些以windows服务方式来运行的组件

* 用户应用程序可以是下面几种类型之一：windows32位或64位，windows 3.1 16位，MS-DOS 16位或者POSIX 32位或者64位。注意，16位应用程序只能运行在32位windows上


* 环境子系统服务器进程实现了操作系统环境的支持部分。这所谓的环境是指操作系统展示给用户或者程序员的个性化部分。widnows NT最初发布的时候带了三个不同的环境子系统：Widnows 、POSI和OS/2。然而，POSIX和OS/2子系统的最后一次发布是随着widnows 2000一起。widnows客户机系统的旗舰和企业版，以及所有服务器版本，包含了一个增强的PSIX子系统，称为UNIX应用子系统

Tips：服务进程和用户应用程序方框下面的子系统DLL方框。在widnows下，用户应用程序并不是直接的调用原生的widnwos操作系统服务，而是通过一个或者多个子系统动态链接库（DLL）来发起调用的。子系统DLL角色是将一个已文档化的函数，转换为一些恰当的内部（通常是未文档化的）原生服务调用。这一转换过程可能会或者不会向正在为用户应用程序提供服务的环境子系统进程发送消息。


widnows内核模式包含：
* widnows执行体，包含了基本的系统操作服务，比如内存管理、进程和线程管理、安全性、I/O、网络和跨进程通信

* widnows内核是由一组低层次的操作系统功能构成的、比如线程调度、中断、和异常分发，以及多处
理器同步。它也提供了一组例程和基本对象，之喜提的其余部分利用这些例程和对象实现更高层次的功能

* 设备驱动程序即包括设备驱动程序，也包括像文件系统和网络驱动程序之类的非硬件设备驱动程序。其中硬件驱动程序将用户的I/O函数调用转换成特定的硬件设备I/O请求

* 硬件抽象层是指一层特殊的代码，它把内核、设备驱动程序和widnows执行体的其余部分，跟与平台相关的硬件差异（比如不同主板的差异）隔离开来

* 窗口和图形系统实现了图形用户界面（GUI）功能，比如对窗口的处理、用户界面的控件，以及绘制等。